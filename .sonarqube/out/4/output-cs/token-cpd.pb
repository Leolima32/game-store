»f
[C:\projects\repos\GameStore\src\1 - UI\GameStore.UI.WebApi\Controllers\AccountController.cs
	namespace 	
	GameStore
 
. 
UI 
. 
WebApi 
. 
Controllers )
{ 
[ 
Route 

(
 
$str &
)& '
]' (
public 

class 
AccountController "
:# $

Controller% /
{ 
private 
readonly 
UserManager $
<$ %
IdentityUser% 1
>1 2
_userManager3 ?
;? @
private 
readonly 
RoleManager $
<$ %
IdentityRole% 1
>1 2
_roleManager3 ?
;? @
private 
readonly 
SignInManager &
<& '
IdentityUser' 3
>3 4
_signInManager5 C
;C D
private 
readonly 
IConfiguration '
_configuration( 6
;6 7
public 
AccountController  
(  !
UserManager 
< 
IdentityUser $
>$ %
userManager& 1
,1 2
RoleManager 
< 
IdentityRole $
>$ %
roleManager& 1
,1 2
SignInManager 
< 
IdentityUser &
>& '
signInManager( 5
,5 6
IConfiguration 
configuration (
)   
{!! 	
_userManager"" 
="" 
userManager"" &
;""& '
_roleManager## 
=## 
roleManager## &
;##& '
_signInManager$$ 
=$$ 
signInManager$$ *
;$$* +
_configuration%% 
=%% 
configuration%% *
;%%* +
}&& 	
[(( 	
HttpPost((	 
](( 
public)) 
async)) 
Task)) 
<)) 
object))  
>))  !
Login))" '
())' (
[))( )
FromBody))) 1
]))1 2
LoginDto))3 ;
model))< A
)))A B
{** 	
var++ 
result++ 
=++ 
await++ 
_signInManager++ -
.++- .
PasswordSignInAsync++. A
(++A B
model++B G
.++G H
UserName++H P
,++P Q
model++R W
.++W X
Password++X `
,++` a
false++b g
,++g h
false++i n
)++n o
;++o p
if-- 
(-- 
result-- 
.-- 
	Succeeded--  
)--  !
{.. 
var// 
appUser// 
=// 
_userManager// *
.//* +
Users//+ 0
.//0 1
SingleOrDefault//1 @
(//@ A
r//A B
=>//C E
r//F G
.//G H
UserName//H P
==//Q S
model//T Y
.//Y Z
UserName//Z b
)//b c
;//c d
return00 
await00 
GenerateJwtToken00 -
(00- .
model00. 3
.003 4
UserName004 <
,00< =
appUser00> E
)00E F
;00F G
}11 
throw33 
new33  
ApplicationException33 *
(33* +
$str33+ B
)33B C
;33C D
}44 	
[66 	
HttpPost66	 
]66 
public77 
async77 
Task77 
<77 
object77  
>77  !
Register77" *
(77* +
[77+ ,
FromBody77, 4
]774 5
RegisterDto776 A
model77B G
)77G H
{88 	
var99 
user99 
=99 
new99 
IdentityUser99 '
{:: 
UserName;; 
=;; 
model;;  
.;;  !
UserName;;! )
,;;) *
Email<< 
=<< 
model<< 
.<< 
Email<< #
}== 
;== 
var>> 
result>> 
=>> 
await>> 
_userManager>> +
.>>+ ,
CreateAsync>>, 7
(>>7 8
user>>8 <
,>>< =
model>>> C
.>>C D
Password>>D L
)>>L M
;>>M N
if@@ 
(@@ 
result@@ 
.@@ 
	Succeeded@@  
)@@  !
{AA 
awaitBB 
_signInManagerBB $
.BB$ %
SignInAsyncBB% 0
(BB0 1
userBB1 5
,BB5 6
falseBB7 <
)BB< =
;BB= >
returnCC 
newCC 
{DD 
tokenEE 
=EE 
awaitEE !
GenerateJwtTokenEE" 2
(EE2 3
modelEE3 8
.EE8 9
EmailEE9 >
,EE> ?
userEE@ D
)EED E
}FF 
;FF 
}GG 
returnHH 
newHH "
BadRequestObjectResultHH -
(HH- .
JsonHH. 2
(HH2 3
resultHH3 9
.HH9 :
ErrorsHH: @
)HH@ A
)HHA B
;HHB C
}II 	
privateKK 
asyncKK 
TaskKK 
<KK 
objectKK !
>KK! "
GenerateJwtTokenKK# 3
(KK3 4
stringKK4 :
userNameKK; C
,KKC D
IdentityUserKKE Q
userKKR V
)KKV W
{LL 	
varMM 
claimsMM 
=MM 
newMM 
ListMM !
<MM! "
ClaimMM" '
>MM' (
{NN 
newOO 
ClaimOO 
(OO #
JwtRegisteredClaimNamesOO 1
.OO1 2
SubOO2 5
,OO5 6
userNameOO7 ?
)OO? @
,OO@ A
newPP 
ClaimPP 
(PP #
JwtRegisteredClaimNamesPP 1
.PP1 2
JtiPP2 5
,PP5 6
GuidPP7 ;
.PP; <
NewGuidPP< C
(PPC D
)PPD E
.PPE F
ToStringPPF N
(PPN O
)PPO P
)PPP Q
,PPQ R
newQQ 
ClaimQQ 
(QQ 

ClaimTypesQQ $
.QQ$ %
NameIdentifierQQ% 3
,QQ3 4
userQQ5 9
.QQ9 :
IdQQ: <
)QQ< =
,QQ= >
}RR 
;RR 
varSS 

userClaimsSS 
=SS 
awaitSS "
_userManagerSS# /
.SS/ 0
GetClaimsAsyncSS0 >
(SS> ?
userSS? C
)SSC D
;SSD E
varTT 
	userRolesTT 
=TT 
awaitTT !
_userManagerTT" .
.TT. /
GetRolesAsyncTT/ <
(TT< =
userTT= A
)TTA B
;TTB C
claimsVV 
.VV 
AddRangeVV 
(VV 

userClaimsVV &
)VV& '
;VV' (
claimsWW 
.WW 
AddRangeWW 
(WW 

userClaimsWW &
)WW& '
;WW' (
foreachXX 
(XX 
varXX 
userRoleXX !
inXX" $
	userRolesXX% .
)XX. /
{YY 
claimsZZ 
.ZZ 
AddZZ 
(ZZ 
newZZ 
ClaimZZ $
(ZZ$ %

ClaimTypesZZ% /
.ZZ/ 0
RoleZZ0 4
,ZZ4 5
userRoleZZ6 >
)ZZ> ?
)ZZ? @
;ZZ@ A
var[[ 
role[[ 
=[[ 
await[[  
_roleManager[[! -
.[[- .
FindByNameAsync[[. =
([[= >
userRole[[> F
)[[F G
;[[G H
if\\ 
(\\ 
role\\ 
!=\\ 
null\\  
)\\  !
{]] 
var^^ 

roleClaims^^ "
=^^# $
await^^% *
_roleManager^^+ 7
.^^7 8
GetClaimsAsync^^8 F
(^^F G
role^^G K
)^^K L
;^^L M
foreach__ 
(__ 
Claim__ "
	roleClaim__# ,
in__- /

roleClaims__0 :
)__: ;
{`` 
claimsaa 
.aa 
Addaa "
(aa" #
	roleClaimaa# ,
)aa, -
;aa- .
}bb 
}cc 
}dd 
varff 
keyff 
=ff 
newff  
SymmetricSecurityKeyff .
(ff. /
Encodingff/ 7
.ff7 8
UTF8ff8 <
.ff< =
GetBytesff= E
(ffE F
_configurationffF T
[ffT U
$strffU ]
]ff] ^
)ff^ _
)ff_ `
;ff` a
vargg 
credsgg 
=gg 
newgg 
SigningCredentialsgg .
(gg. /
keygg/ 2
,gg2 3
SecurityAlgorithmsgg4 F
.ggF G

HmacSha256ggG Q
)ggQ R
;ggR S
varhh 
expireshh 
=hh 
DateTimehh "
.hh" #
Nowhh# &
.hh& '
AddDayshh' .
(hh. /
Converthh/ 6
.hh6 7
ToDoublehh7 ?
(hh? @
_configurationhh@ N
[hhN O
$strhhO ^
]hh^ _
)hh_ `
)hh` a
;hha b
varjj 
tokenjj 
=jj 
newjj 
JwtSecurityTokenjj ,
(jj, -
_configurationkk 
[kk 
$strkk *
]kk* +
,kk+ ,
_configurationll 
[ll 
$strll ,
]ll, -
,ll- .
claimsmm 
,mm 
expiresnn 
:nn 
expiresnn  
,nn  !
signingCredentialsoo "
:oo" #
credsoo$ )
)pp 
;pp 
returnrr 
newrr #
JwtSecurityTokenHandlerrr .
(rr. /
)rr/ 0
.rr0 1

WriteTokenrr1 ;
(rr; <
tokenrr< A
)rrA B
;rrB C
}ss 	
[uu 	
HttpGetuu	 
]uu 
publicvv 
objectvv 

UserClaimsvv  
(vv  !
)vv! "
{ww 	
ifxx 
(xx 
!xx 
Userxx 
.xx 
Identityxx 
.xx 
IsAuthenticatedxx .
)xx. /
returnyy 
newyy "
BadRequestObjectResultyy 1
(yy1 2
$stryy2 B
)yyB C
;yyC D
var{{ 
identityClaims{{ 
={{  
({{! "
ClaimsIdentity{{" 0
){{0 1
User{{1 5
.{{5 6
Identity{{6 >
;{{> ?
var|| 
roles|| 
=|| 
identityClaims|| &
.||& '
FindAll||' .
(||. /

ClaimTypes||/ 9
.||9 :
Role||: >
)||> ?
;||? @
return}} 
new}} 
AccountModel}} #
(}}# $
)}}$ %
{~~ 
UserName 
= 
identityClaims )
.) *
	FindFirst* 3
(3 4
$str4 9
)9 :
.: ;
Value; @
,@ A
Roles
ÄÄ 
=
ÄÄ 
roles
ÄÄ 
.
ÄÄ 
Select
ÄÄ $
(
ÄÄ$ %
_
ÄÄ% &
=>
ÄÄ' )
_
ÄÄ* +
.
ÄÄ+ ,
Value
ÄÄ, 1
)
ÄÄ1 2
}
ÅÅ 
;
ÅÅ 
}
ÇÇ 	
public
ÑÑ 
class
ÑÑ 
LoginDto
ÑÑ 
{
ÖÖ 	
[
ÜÜ 
Required
ÜÜ 
]
ÜÜ 
public
áá 
string
áá 
UserName
áá "
{
áá# $
get
áá% (
;
áá( )
set
áá* -
;
áá- .
}
áá/ 0
[
ââ 
Required
ââ 
]
ââ 
public
ää 
string
ää 
Password
ää "
{
ää# $
get
ää% (
;
ää( )
set
ää* -
;
ää- .
}
ää/ 0
}
åå 	
public
éé 
class
éé 
RegisterDto
éé  
{
èè 	
[
êê 
Required
êê 
]
êê 
public
ëë 
string
ëë 
Email
ëë 
{
ëë  !
get
ëë" %
;
ëë% &
set
ëë' *
;
ëë* +
}
ëë, -
[
ìì 
Required
ìì 
]
ìì 
public
îî 
string
îî 
UserName
îî "
{
îî# $
get
îî% (
;
îî( )
set
îî* -
;
îî- .
}
îî/ 0
[
ññ 
Required
ññ 
]
ññ 
[
óó 
StringLength
óó 
(
óó 
$num
óó 
,
óó 
ErrorMessage
óó +
=
óó, -
$str
óó. C
,
óóC D
MinimumLength
óóE R
=
óóS T
$num
óóU V
)
óóV W
]
óóW X
public
òò 
string
òò 
Password
òò "
{
òò# $
get
òò% (
;
òò( )
set
òò* -
;
òò- .
}
òò/ 0
}
ôô 	
}
öö 
}õõ ∂
]C:\projects\repos\GameStore\src\1 - UI\GameStore.UI.WebApi\Controllers\CompaniesController.cs
	namespace 	
	GameStore
 
. 
UI 
. 
WebApi 
. 
Controllers )
{ 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
CompaniesController $
:$ %

Controller& 0
{ 
private 
ICompanyServices  
	_services! *
;* +
public 
CompaniesController "
(" #
ICompanyServices# 3
services4 <
)< =
{ 	
	_services 
= 
services  
;  !
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IEnumerable %
<% &
CompanyViewModel& 6
>6 7
>7 8
Get9 <
(< =
)= >
{? @
return 
await 
	_services "
." #
GetAllCompanies# 2
(2 3
)3 4
;4 5
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
async 
Task 
< 
CompanyViewModel *
>* +
Get, /
(/ 0
Guid0 4
id5 7
)7 8
{9 :
return 
await 
	_services "
." #
GetCompanyById# 1
(1 2
id2 4
)4 5
;5 6
} 	
[!! 	
	Authorize!!	 
(!! 
Roles!! 
=!! 
$str!! "
)!!" #
]!!# $
["" 	
HttpPost""	 
]"" 
public## 
void## 
Post## 
(## 
[## 
FromBody## "
]##" #!
AddOrUpdateCompanyDTO### 8
company##9 @
)##@ A
{$$ 	
	_services%% 
.%% 
InsertCompany%% #
(%%# $
company%%$ +
)%%+ ,
;%%, -
}&& 	
[(( 	
	Authorize((	 
((( 
Roles(( 
=(( 
$str(( "
)((" #
]((# $
[)) 	
HttpPut))	 
])) 
public** 
void** 
Update** 
(** 
[** 
FromBody** $
]**$ %!
AddOrUpdateCompanyDTO**% :
company**; B
)**B C
{++ 	
	_services,, 
.,, 
UpdateCompany,, #
(,,# $
company,,$ +
),,+ ,
;,,, -
}-- 	
[// 	
	Authorize//	 
(// 
Roles// 
=// 
$str// "
)//" #
]//# $
[00 	

HttpDelete00	 
(00 
$str00 
)00 
]00 
public11 
void11 
Delete11 
(11 
Guid11 
id11  "
)11" #
{22 	
	_services33 
.33 
DeleteCompany33 #
(33# $
id33$ &
)33& '
;33' (
}44 	
}55 
}66 ÍI
YC:\projects\repos\GameStore\src\1 - UI\GameStore.UI.WebApi\Controllers\GamesController.cs
	namespace 	
	GameStore
 
. 
UI 
. 
WebApi 
. 
Controllers )
{ 
[ 
ValidateModel 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
GamesController  
:! "

Controller# -
{ 
private 
IGameServices 
	_services '
;' (
private 
IHostingEnvironment #
_hostingEnvironment$ 7
;7 8
public 
GamesController 
( 
IGameServices ,
services- 5
,5 6
IHostingEnvironment7 J
hostingEnvironmentK ]
)] ^
{ 	
	_services 
= 
services  
;  !
_hostingEnvironment 
=  !
hostingEnvironment" 4
;4 5
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IEnumerable %
<% &
GameListViewModel& 7
>7 8
>8 9
Get: =
(= >
)> ?
{ 	
return   
await   
	_services   "
.  " #
GetAllGames  # .
(  . /
)  / 0
;  0 1
}!! 	
[## 	
HttpGet##	 
(## 
$str## (
)##( )
]##) *
public$$ 
async$$ 
Task$$ 
<$$ 
IEnumerable$$ %
<$$% &
GameListViewModel$$& 7
>$$7 8
>$$8 9
GetListByGenre$$: H
($$H I
Guid$$I M
genreId$$N U
)$$U V
{%% 	
return&& 
await&& 
	_services&& "
.&&" #
GetGamesByGenre&&# 2
(&&2 3
genreId&&3 :
)&&: ;
;&&; <
}'' 	
[)) 	
HttpGet))	 
()) 
$str)) 
))) 
])) 
public** 
async** 
Task** 
<** 
GameViewModel** '
>**' (
Get**) ,
(**, -
Guid**- 1
id**2 4
)**4 5
{++ 	
return,, 
await,, 
	_services,, "
.,," #
GetGameById,,# .
(,,. /
id,,/ 1
),,1 2
;,,2 3
}-- 	
[// 	
HttpGet//	 
(// 
$str// 
)// 
]// 
public00 
async00 
Task00 
<00 
IEnumerable00 %
<00% &
GameListViewModel00& 7
>007 8
>008 9
GetBestRatedGames00: K
(00K L
)00L M
{11 	
return22 
await22 
	_services22 "
.22" #
GetBestRatedGames22# 4
(224 5
)225 6
;226 7
}33 	
[55 	
HttpGet55	 
(55 
$str55 
)55 
]55  
public66 
async66 
Task66 
<66 
IEnumerable66 %
<66% &
GameListViewModel66& 7
>667 8
>668 9
GetBestSellerGames66: L
(66L M
)66M N
{77 	
return88 
await88 
	_services88 "
.88" #
GetBestSellerGames88# 5
(885 6
)886 7
;887 8
}99 	
[;; 	
	Authorize;;	 
(;; 
Roles;; 
=;; 
$str;; "
);;" #
];;# $
[<< 	
HttpPost<<	 
]<< 
public== 
ActionResult== 
Post==  
(==  !
[==! "
FromBody==" *
]==* +
AddOrUpdateGameDTO==+ =
game==> B
)==B C
{>> 	
var?? 
id?? 
=?? 
	_services?? 
.?? 

InsertGame?? )
(??) *
game??* .
)??. /
;??/ 0
if@@ 
(@@ 
id@@ 
!=@@ 
null@@ 
)@@ 
{AA 
returnBB 
newBB 
OkObjectResultBB )
(BB) *
newBB* -
ResultViewModelBB. =
(BB= >
idBB> @
,BB@ A
$numBBB E
,BBE F
$strBBG Q
)BBQ R
)BBR S
;BBS T
}CC 
elseDD 
{EE 
returnFF 
newFF "
BadRequestObjectResultFF 1
(FF1 2
newFF2 5
ResultViewModelFF6 E
(FFE F
$numFFF I
,FFI J
$strFFK s
)FFs t
)FFt u
;FFu v
}GG 
}HH 	
[JJ 	
	AuthorizeJJ	 
(JJ 
RolesJJ 
=JJ 
$strJJ "
)JJ" #
]JJ# $
[KK 	
HttpPutKK	 
]KK 
publicLL 
voidLL 
UpdateLL 
(LL 
[LL 
FromBodyLL $
]LL$ %
AddOrUpdateGameDTOLL% 7
gameLL8 <
)LL< =
{MM 	
	_servicesNN 
.NN 

UpdateGameNN  
(NN  !
gameNN! %
)NN% &
;NN& '
}OO 	
[QQ 	
	AuthorizeQQ	 
(QQ 
RolesQQ 
=QQ 
$strQQ "
)QQ" #
]QQ# $
[RR 	

HttpDeleteRR	 
(RR 
$strRR 
)RR 
]RR 
publicSS 
voidSS 
DeleteSS 
(SS 
GuidSS 
idSS  "
)SS" #
{TT 	
	_servicesUU 
.UU 

DeleteGameUU  
(UU  !
idUU! #
)UU# $
;UU$ %
}VV 	
[XX 	
	AuthorizeXX	 
(XX 
RolesXX 
=XX 
$strXX "
)XX" #
]XX# $
[YY 	
HttpPutYY	 
(YY 
$strYY (
)YY( )
]YY) *
publicZZ 
asyncZZ 
TaskZZ 
<ZZ 
ActionResultZZ &
>ZZ& '
UploadThumbImageZZ( 8
(ZZ8 9
GuidZZ9 =
idZZ> @
)ZZ@ A
{[[ 	
try\\ 
{]] 
var^^ 
file^^ 
=^^ 
Request^^ "
.^^" #
Form^^# '
.^^' (
Files^^( -
[^^- .
$num^^. /
]^^/ 0
;^^0 1
string__ 

folderName__ !
=__" #
$str__$ 3
+__4 5
id__6 8
+__9 :
$str__; C
;__C D
string`` 
webRootPath`` "
=``# $
_hostingEnvironment``% 8
.``8 9
WebRootPath``9 D
;``D E
stringaa 
newPathaa 
=aa  
Pathaa! %
.aa% &
Combineaa& -
(aa- .
webRootPathaa. 9
,aa9 :

folderNameaa; E
)aaE F
;aaF G
ifbb 
(bb 
!bb 
	Directorybb 
.bb 
Existsbb %
(bb% &
newPathbb& -
)bb- .
)bb. /
{cc 
	Directorydd 
.dd 
CreateDirectorydd -
(dd- .
newPathdd. 5
)dd5 6
;dd6 7
}ee 
ifff 
(ff 
fileff 
.ff 
Lengthff 
>ff  !
$numff" #
)ff# $
{gg 
stringhh 
fileNamehh #
=hh$ %)
ContentDispositionHeaderValuehh& C
.hhC D
ParsehhD I
(hhI J
filehhJ N
.hhN O
ContentDispositionhhO a
)hha b
.hhb c
FileNamehhc k
.hhk l
Trimhhl p
(hhp q
$charhhq t
)hht u
;hhu v
stringii 
fullPathii #
=ii$ %
Pathii& *
.ii* +
Combineii+ 2
(ii2 3
newPathii3 :
,ii: ;
fileNameii< D
)iiD E
;iiE F
usingjj 
(jj 
varjj 
streamjj %
=jj& '
newjj( +

FileStreamjj, 6
(jj6 7
fullPathjj7 ?
,jj? @
FileModejjA I
.jjI J
CreatejjJ P
)jjP Q
)jjQ R
{kk 
filell 
.ll 
CopyToll #
(ll# $
streamll$ *
)ll* +
;ll+ ,
}mm 
awaitoo 
	_servicesoo #
.oo# $
UpdateThumbImageoo$ 4
(oo4 5
idoo5 7
,oo7 8
$stroo9 <
+oo= >

folderNameoo? I
+ooJ K
$strooL O
+ooP Q
fileNameooR Z
)ooZ [
;oo[ \
}pp 
returnqq 
Jsonqq 
(qq 
$strqq 0
)qq0 1
;qq1 2
}rr 
catchss 
(ss 
Systemss 
.ss 
	Exceptionss #
exss$ &
)ss& '
{tt 
returnuu 
Jsonuu 
(uu 
$struu -
+uu. /
exuu0 2
.uu2 3
Messageuu3 :
)uu: ;
;uu; <
}vv 
}ww 	
}xx 
}yy é
ZC:\projects\repos\GameStore\src\1 - UI\GameStore.UI.WebApi\Controllers\GenresController.cs
	namespace 	
	GameStore
 
. 
UI 
. 
WebApi 
. 
Controllers )
{ 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
GenresController !
:" #

Controller$ .
{ 
private 
IGenreServices 
	_services (
;( )
public 
GenresController 
(  
IGenreServices  .
services/ 7
)7 8
{ 	
	_services 
= 
services  
;  !
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IEnumerable %
<% &
GenreViewModel& 4
>4 5
>5 6
Get7 :
(: ;
); <
{ 	
return 
await 
	_services "
." #
GetAllGenres# /
(/ 0
)0 1
;1 2
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
async 
Task 
< 
GenreViewModel (
>( )
Get* -
(- .
Guid. 2
id3 5
)5 6
{ 	
return 
await 
	_services "
." #
GetGenreById# /
(/ 0
id0 2
)2 3
;3 4
}   	
["" 	
	Authorize""	 
("" 
Roles"" 
="" 
$str"" "
)""" #
]""# $
[## 	
HttpPost##	 
]## 
public$$ 
void$$ 
Post$$ 
($$ 
[$$ 
FromBody$$ "
]$$" #
AddOrUpdateGenreDTO$$# 6
genre$$7 <
)$$< =
{%% 	
	_services&& 
.&& 
InsertGenre&& !
(&&! "
genre&&" '
)&&' (
;&&( )
}'' 	
[)) 	
	Authorize))	 
()) 
Roles)) 
=)) 
$str)) "
)))" #
]))# $
[** 	
HttpPut**	 
]** 
public++ 
void++ 
Update++ 
(++ 
[++ 
FromBody++ $
]++$ %
AddOrUpdateGenreDTO++% 8
genre++9 >
)++> ?
{,, 	
	_services-- 
.-- 
UpdateGenre-- !
(--! "
genre--" '
)--' (
;--( )
}.. 	
[00 	
	Authorize00	 
(00 
Roles00 
=00 
$str00 "
)00" #
]00# $
[11 	

HttpDelete11	 
(11 
$str11 
)11 
]11 
public22 
void22 
Delete22 
(22 
Guid22 
id22  "
)22" #
{33 	
	_services44 
.44 
DeleteGenre44 !
(44! "
id44" $
)44$ %
;44% &
}55 	
}66 
}77 º
ZC:\projects\repos\GameStore\src\1 - UI\GameStore.UI.WebApi\Controllers\OrdersController.cs
	namespace		 	
	GameStore		
 
.		 
UI		 
.		 
WebApi		 
.		 
Controllers		 )
{

 
[ 
Route 

(
 
$str &
)& '
]' (
public 

class 
OrdersController !
:" #

Controller$ .
{ 
private 
readonly 
UserManager $
<$ %
IdentityUser% 1
>1 2
_userManager3 ?
;? @
private 
IOrderServices 
	_services (
;( )
public 
OrdersController 
(  
IOrderServices  .
services/ 7
,7 8
UserManager9 D
<D E
IdentityUserE Q
>Q R
userManagerS ^
)^ _
{ 	
	_services 
= 
services  
;  !
_userManager 
= 
userManager &
;& '
} 	
[ 	
	Authorize	 
( 
Roles 
= 
$str %
)% &
]& '
[ 	
HttpPost	 
] 
public 
CommandResult !
FinishCreditCardOrder 2
(2 3
[3 4
FromBody4 <
]< =(
FinishCreditCardOrderCommand= Y
orderZ _
)_ `
{ 	
return 
	_services 
. !
FinishCreditCardOrder 2
(2 3
order3 8
,8 9
Guid: >
.> ?
Parse? D
(D E
_userManagerE Q
.Q R
	GetUserIdR [
([ \
HttpContext\ g
.g h
Userh l
)l m
)m n
)n o
;o p
} 	
[ 	
	Authorize	 
( 
Roles 
= 
$str %
)% &
]& '
[ 	
HttpPost	 
] 
public   
CommandResult   
FinishPayPalOrder   .
(  . /
[  / 0
FromBody  0 8
]  8 9$
FinishPayPalOrderCommand  9 Q
order  R W
)  W X
{!! 	
return## 
	_services## 
.## 
FinishPayPalOrder## .
(##. /
order##/ 4
,##4 5
Guid##6 :
.##: ;
Parse##; @
(##@ A
_userManager##A M
.##M N
	GetUserId##N W
(##W X
HttpContext##X c
.##c d
User##d h
)##h i
)##i j
)##j k
;##k l
}$$ 	
}%% 
}&& ƒ
]C:\projects\repos\GameStore\src\1 - UI\GameStore.UI.WebApi\Controllers\PlatformsController.cs
	namespace 	
	GameStore
 
. 
UI 
. 
WebApi 
. 
Controllers )
{ 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
PlatformsController $
:% &

Controller' 1
{ 
private 
IPlatformServices !
	_services" +
;+ ,
public 
PlatformsController "
(" #
IPlatformServices# 4
services5 =
)= >
{ 	
	_services 
= 
services  
;  !
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IEnumerable %
<% &
PlatformViewModel& 7
>7 8
>8 9
Get: =
(= >
)> ?
{ 	
return 
await 
	_services "
." #
GetAllPlatforms# 2
(2 3
)3 4
;4 5
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
async 
Task 
< 
PlatformViewModel +
>+ ,
Get- 0
(0 1
Guid1 5
id6 8
)8 9
{ 	
return 
await 
	_services "
." #
GetPlatformById# 2
(2 3
id3 5
)5 6
;6 7
}   	
["" 	
	Authorize""	 
("" 
Roles"" 
="" 
$str"" "
)""" #
]""# $
[## 	
HttpPost##	 
]## 
public$$ 
void$$ 
Post$$ 
($$ 
[$$ 
FromBody$$ "
]$$" #"
AddOrUpdatePlatformDTO$$# 9
platform$$: B
)$$B C
{%% 	
	_services&& 
.&& 
InsertPlatform&& $
(&&$ %
platform&&% -
)&&- .
;&&. /
}'' 	
[)) 	
	Authorize))	 
()) 
Roles)) 
=)) 
$str)) "
)))" #
]))# $
[** 	
HttpPut**	 
]** 
public++ 
void++ 
Update++ 
(++ 
[++ 
FromBody++ $
]++$ %"
AddOrUpdatePlatformDTO++% ;
platform++< D
)++D E
{,, 	
	_services-- 
.-- 
UpdatePlatform-- $
(--$ %
platform--% -
)--- .
;--. /
}.. 	
[00 	
	Authorize00	 
(00 
Roles00 
=00 
$str00 "
)00" #
]00# $
[11 	

HttpDelete11	 
(11 
$str11 
)11 
]11 
public22 
void22 
Delete22 
(22 
Guid22 
id22  "
)22" #
{33 	
	_services44 
.44 
DeletePlatform44 $
(44$ %
id44% '
)44' (
;44( )
}55 	
}66 
}77 ∆
[C:\projects\repos\GameStore\src\1 - UI\GameStore.UI.WebApi\Controllers\ReviewsController.cs
	namespace 	
	GameStore
 
. 
UI 
. 
WebApi 
. 
Controllers )
{ 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
ReviewsController "
:# $

Controller% /
{ 
private 
readonly 
UserManager $
<$ %
IdentityUser% 1
>1 2
_userManager3 ?
;? @
private 
IReviewServices 
	_services  )
;) *
public 
ReviewsController  
(  !
IReviewServices! 0
services1 9
,9 :
UserManager; F
<F G
IdentityUserG S
>S T
userManagerU `
)` a
{ 	
	_services 
= 
services  
;  !
_userManager 
= 
userManager &
;& '
} 	
[ 	
Route	 
( 
$str 
) 
] 
[ 	
HttpGet	 
] 
public 
IEnumerable 
< 
ReviewListViewModel .
>. /
GetByProductId0 >
(> ?
Guid? C
idD F
)F G
{H I
return 
	_services 
.  
GetReviewByProductId 1
(1 2
id2 4
)4 5
;5 6
} 	
[!! 	
Route!!	 
(!! 
$str!! 
)!! 
]!! 
["" 	
HttpGet""	 
]"" 
public## 
IEnumerable## 
<## 
ReviewListViewModel## .
>##. /
GetByUserId##0 ;
(##; <
Guid##< @
id##A C
)##C D
{##E F
return$$ 
	_services$$ 
.$$ 
GetReviewByUserId$$ .
($$. /
id$$/ 1
)$$1 2
;$$2 3
}%% 	
['' 	
	Authorize''	 
('' 
Roles'' 
='' 
$str'' %
)''% &
]''& '
[(( 	
HttpPost((	 
](( 
public)) 
ActionResult)) 
Post))  
())  !
[))! "
FromBody))" *
]))* + 
AddOrUpdateReviewDTO))+ ?
review))@ F
)))F G
{** 	
var++ 
id++ 
=++ 
	_services++ 
.++ 
Save++ #
(++# $
review++$ *
)++* +
;+++ ,
if,, 
(,, 
id,, 
!=,, 
null,, 
),, 
{,, 
return-- 
new-- 
OkObjectResult-- )
(--) *
new--* -
ResultViewModel--. =
(--= >
id--> @
,--@ A
$num--A D
,--D E
$str--E O
)--O P
)--P Q
;--Q R
}.. 
else.. 
{.. 
return// 
new// "
BadRequestObjectResult// 1
(//1 2
new//2 5
ResultViewModel//6 E
(//E F
$num//F I
,//I J
$str//K s
)//s t
)//t u
;//u v
}00 
}11 	
}22 
}33 ¿
ZC:\projects\repos\GameStore\src\1 - UI\GameStore.UI.WebApi\Controllers\ValuesController.cs
	namespace 	
	GameStore
 
. 
UI 
. 
WebApi 
. 
Controllers )
{ 
public 

class 
ValuesController !
:" #

Controller$ .
{ 
[		 	
	Authorize			 
]		 
[

 	
HttpGet

	 
(

 
$str

 
)

 
]

 
public 
object 
Claims 
( 
) 
{ 	
return 
User 
. 
Claims 
. 
Select %
(% &
c& '
=>( *
new 
{ 
Type 
= 
c 
. 
Type 
, 
Value 
= 
c 
. 
Value 
} 
) 
; 
} 	
} 
} »	
XC:\projects\repos\GameStore\src\1 - UI\GameStore.UI.WebApi\Filters\ApiExceptionFilter.cs
	namespace 	
	GameStore
 
. 
UI 
. 
WebApi 
. 
Filters %
{ 
public 

class 
ApiExceptionFilter #
:$ %$
ExceptionFilterAttribute& >
{ 
public		 
override		 
void		 
OnException		 (
(		( )
ExceptionContext		) 9
context		: A
)		A B
{

 	
context 
. 
HttpContext 
.  
Response  (
.( )

StatusCode) 3
=4 5
$num6 9
;9 :
context 
. 
Result 
= 
new  

JsonResult! +
(+ ,
new, /
{ 
context 
. 
	Exception !
.! "
Message" )
,) *
context 
. 
	Exception !
.! "

StackTrace" ,
,, -
} 
) 
; 
} 	
} 
} ï
\C:\projects\repos\GameStore\src\1 - UI\GameStore.UI.WebApi\Filters\ValidateModelAttribute.cs
	namespace 	
	GameStore
 
. 
UI 
. 
WebApi 
. 
Filters %
{ 
public 

class "
ValidateModelAttribute '
:( )!
ActionFilterAttribute* ?
{ 
public 
override 
void 
OnActionExecuting .
(. /"
ActionExecutingContext/ E
contextF M
)M N
{		 	
if

 
(

 
!

 
context

 
.

 

ModelState

 #
.

# $
IsValid

$ +
)

+ ,
{ 
context 
. 
Result 
=  
new! $"
BadRequestObjectResult% ;
(; <
context< C
.C D

ModelStateD N
)N O
;O P
} 
} 	
} 
} ¢
OC:\projects\repos\GameStore\src\1 - UI\GameStore.UI.WebApi\HostSeedDbContext.cs
	namespace 	
	GameStore
 
. 
UI 
. 
WebApi 
{ 
public 

static 
class 
HostSeedDbContext )
{ 
public 
static 
IHost 
SeedDbContext )
<) *
TContext* 2
>2 3
(3 4
this4 8
IHost9 >
host? C
)C D
whereE J
TContextK S
:T U
	DbContextV _
{ 	
using 
( 
var 
scope 
= 
host #
.# $
Services$ ,
., -
CreateScope- 8
(8 9
)9 :
): ;
{ 
var 
services 
= 
scope $
.$ %
ServiceProvider% 4
;4 5
try 
{ 
var 
context 
=  !
services" *
.* +
GetRequiredService+ =
<= >
GameStoreContext> N
>N O
(O P
)P Q
;Q R
var 
configuration %
=& '
services( 0
.0 1
GetRequiredService1 C
<C D
IConfigurationD R
>R S
(S T
)T U
;U V
var 
userManager #
=$ %
services& .
.. /
GetRequiredService/ A
<A B
UserManagerB M
<M N
IdentityUserN Z
>Z [
>[ \
(\ ]
)] ^
;^ _
var 
roleManager #
=$ %
services& .
.. /
GetRequiredService/ A
<A B
RoleManagerB M
<M N
IdentityRoleN Z
>Z [
>[ \
(\ ]
)] ^
;^ _
DbInitializer !
.! "

Initialize" ,
(, -
context- 4
,4 5
configuration6 C
,C D
userManagerE P
,P Q
roleManagerR ]
)] ^
.^ _

GetAwaiter_ i
(i j
)j k
.k l
	GetResultl u
(u v
)v w
;w x
} 
catch 
( 
	Exception  
ex! #
)# $
{ 
var   
logger   
=    
services  ! )
.  ) *
GetRequiredService  * <
<  < =
ILogger  = D
<  D E
Program  E L
>  L M
>  M N
(  N O
)  O P
;  P Q
logger!! 
.!! 
LogError!! #
(!!# $
ex!!$ &
,!!& '
$str!!( W
)!!W X
;!!X Y
}"" 
}## 
return%% 
host%% 
;%% 
}&& 	
}'' 
}(( …
QC:\projects\repos\GameStore\src\1 - UI\GameStore.UI.WebApi\Models\AccountModel.cs
	namespace 	
	GameStore
 
. 
UI 
. 
WebApi 
. 
Models $
{ 
public 

class 
AccountModel 
{ 
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
IEnumerable 
< 
string !
>! "
Roles# (
{) *
get* -
;- .
set. 1
;1 2
}2 3
}		 
}

 ‚
EC:\projects\repos\GameStore\src\1 - UI\GameStore.UI.WebApi\Program.cs
	namespace 	
	GameStore
 
. 
UI 
. 
WebApi 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
. 
SeedDbContext 
< 
GameStoreContext /
>/ 0
(0 1
)1 2
. 
Run 
( 
) 
; 
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder   
.   

UseStartup   )
<  ) *
Startup  * 1
>  1 2
(  2 3
)  3 4
;  4 5
}!! 
)!! 
;!! 
}"" 
}## Ω>
EC:\projects\repos\GameStore\src\1 - UI\GameStore.UI.WebApi\Startup.cs
	namespace 	
	GameStore
 
. 
UI 
. 
WebApi 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services   
.   
AddCors   
(   
options   $
=>  % '
options  ( /
.  / 0
	AddPolicy  0 9
(  9 :
$str  : K
,  K L
builder!! 
=>!! 
{"" 
builder## 
.## 
AllowAnyOrigin## )
(##) *
)##* +
.$$ 
AllowAnyMethod$$ "
($$" #
)$$# $
.%% 
AllowAnyHeader%% "
(%%" #
)%%# $
;%%$ %
}&& 
)&& 
)&& 
;&& 
services(( 
.(( 
AddAutoMapper(( "
(((" #
)((# $
;(($ %
services)) 
.)) 
AddDbContext)) !
<))! "
GameStoreContext))" 2
>))2 3
())3 4
options))4 ;
=>))< >
options** 
.** 
UseSqlServer** #
(**# $
Configuration**$ 1
.**1 2
GetConnectionString**2 E
(**E F
$str**F Y
)**Y Z
)**Z [
)**[ \
;**\ ]
services,, 
.,, 
AddIdentity,,  
<,,  !
IdentityUser,,! -
,,,- .
IdentityRole,,/ ;
>,,; <
(,,< =
),,= >
.-- $
AddEntityFrameworkStores-- )
<--) *
GameStoreContext--* :
>--: ;
(--; <
)--< =
... $
AddDefaultTokenProviders.. )
(..) *
)..* +
;..+ ,
services00 
.00 
AddSingleton00 !
<00! "
IConfiguration00" 0
>000 1
(001 2
Configuration002 ?
)00? @
;00@ A#
JwtSecurityTokenHandler22 #
.22# $&
DefaultInboundClaimTypeMap22$ >
.22> ?
Clear22? D
(22D E
)22E F
;22F G
services33 
.44 
AddAuthentication44 "
(44" #
options44# *
=>44+ -
{55 
options66 
.66 %
DefaultAuthenticateScheme66 5
=666 7
JwtBearerDefaults668 I
.66I J 
AuthenticationScheme66J ^
;66^ _
options77 
.77 
DefaultScheme77 )
=77* +
JwtBearerDefaults77, =
.77= > 
AuthenticationScheme77> R
;77R S
options88 
.88 "
DefaultChallengeScheme88 2
=883 4
JwtBearerDefaults885 F
.88F G 
AuthenticationScheme88G [
;88[ \
}:: 
):: 
.;; 
AddJwtBearer;; 
(;; 
cfg;; !
=>;;" $
{<< 
cfg== 
.==  
RequireHttpsMetadata== ,
===- .
false==/ 4
;==4 5
cfg>> 
.>> 
	SaveToken>> !
=>>" #
true>>$ (
;>>( )
cfg?? 
.?? %
TokenValidationParameters?? 1
=??2 3
new??4 7%
TokenValidationParameters??8 Q
{@@ 
ValidIssuerAA #
=AA$ %
ConfigurationAA& 3
[AA3 4
$strAA4 ?
]AA? @
,AA@ A
ValidAudienceBB %
=BB& '
ConfigurationBB( 5
[BB5 6
$strBB6 C
]BBC D
,BBD E
IssuerSigningKeyCC (
=CC) *
newCC+ . 
SymmetricSecurityKeyCC/ C
(CCC D
EncodingCCD L
.CCL M
UTF8CCM Q
.CCQ R
GetBytesCCR Z
(CCZ [
ConfigurationCC[ h
[CCh i
$strCCi q
]CCq r
)CCr s
)CCs t
,CCt u
	ClockSkewDD !
=DD" #
TimeSpanDD$ ,
.DD, -
ZeroDD- 1
}EE 
;EE 
}FF 
)FF 
;FF 
servicesHH 
.HH 
AddControllersHH #
(HH# $
)HH$ %
;HH% &
servicesKK 
.KK 
AddSwaggerGenKK "
(KK" #
cKK# $
=>KK% '
{LL 
cMM 
.MM 

SwaggerDocMM 
(MM 
$strMM !
,MM! "
newMM# &
OpenApiInfoMM' 2
{MM3 4
TitleMM5 :
=MM; <
$strMM= I
,MMI J
VersionMMK R
=MMS T
$strMMU Y
}MMZ [
)MM[ \
;MM\ ]
cNN 
.NN !
AddSecurityDefinitionNN '
(NN' (
$strNN( 0
,NN0 1
newNN2 5!
OpenApiSecuritySchemeNN6 K
(NNK L
)NNL M
{NNN O
InNNP R
=NNS T
ParameterLocationNNU f
.NNf g
HeaderNNg m
,NNm n
DescriptionNNo z
=NN{ |
$str	NN} ß
,
NNß ®
Name
NN© ≠
=
NNÆ Ø
$str
NN∞ ø
,
NNø ¿
Type
NN¡ ≈
=
NN∆ « 
SecuritySchemeType
NN» ⁄
.
NN⁄ €
ApiKey
NN€ ·
}
NN‚ „
)
NN„ ‰
;
NN‰ Â
}OO 
)OO 
;OO 
RegisterServicesQQ 
(QQ 
servicesQQ %
)QQ% &
;QQ& '
}RR 	
publicUU 
voidUU 
	ConfigureUU 
(UU 
IApplicationBuilderUU 1
appUU2 5
,UU5 6
IWebHostEnvironmentUU7 J
envUUK N
)UUN O
{VV 	
appWW 
.WW %
UseDeveloperExceptionPageWW )
(WW) *
)WW* +
;WW+ ,
appXX 
.XX 
UseStaticFilesXX 
(XX 
)XX  
;XX  !
appYY 
.YY 
UseCorsYY 
(YY 
$strYY )
)YY) *
;YY* +
app[[ 
.[[ 

UseSwagger[[ 
([[ 
)[[ 
;[[ 
app]] 
.]] 
UseSwaggerUI]] 
(]] 
c]] 
=>]] !
{^^ 
c__ 
.__ 
SwaggerEndpoint__ !
(__! "
$str__" <
,__< =
$str__> J
)__J K
;__K L
}`` 
)`` 
;`` 
appbb 
.bb 
UseAuthenticationbb !
(bb! "
)bb" #
;bb# $
appdd 
.dd 

UseRoutingdd 
(dd 
)dd 
;dd 
appff 
.ff 
UseAuthorizationff  
(ff  !
)ff! "
;ff" #
apphh 
.hh 
UseEndpointshh 
(hh 
	endpointshh &
=>hh' )
{ii 
	endpointsjj 
.jj 
MapControllersjj (
(jj( )
)jj) *
;jj* +
}kk 
)kk 
;kk 
}ll 	
publicmm 
staticmm 
voidmm 
RegisterServicesmm +
(mm+ ,
IServiceCollectionmm, >
servicesmm? G
)mmG H
{nn 	&
NativeInjectorBootStrapperoo &
.oo& '
RegisterServicesoo' 7
(oo7 8
servicesoo8 @
)oo@ A
;ooA B
}pp 	
}qq 
}rr 